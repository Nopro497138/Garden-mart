<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Garden Mart</title>
  <link rel="icon" type="image/png" href="images/favicon.png" />
  <style>
    /* Reset */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color:#fff;
      background:#021004;
      overflow-x:hidden;
    }

    /* ===== Star Canvas + Green Nebula ===== */
    #star-canvas{position:fixed;inset:0;z-index:0}
    .nebula{
      position:fixed;inset:0;z-index:0;pointer-events:none;
      background:
        radial-gradient(800px 500px at 10% 20%, rgba(0,255,120,0.14), transparent 10%),
        radial-gradient(900px 500px at 80% 70%, rgba(0,180,100,0.08), transparent 8%),
        radial-gradient(600px 350px at 50% 40%, rgba(80,255,180,0.06), transparent 6%);
      filter: blur(40px) saturate(1.05);
      opacity:0.95; mix-blend-mode: screen;
      animation: nebMove 26s linear infinite, nebRotate 60s linear infinite;
    }
    @keyframes nebMove { 0%{transform:translateY(0)}50%{transform:translateY(-40px)}100%{transform:translateY(0)} }
    @keyframes nebRotate { 0%{transform:rotate(0deg)}100%{transform:rotate(360deg)} }

    .gloss { position:fixed;inset:0;z-index:0;pointer-events:none; background:
      linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0));
      mix-blend-mode: overlay; opacity:0.6;
    }

    /* ===== Header ===== */
    header{
      position:relative;z-index:3;display:flex;justify-content:space-between;align-items:center;
      padding:20px 36px;
      background:linear-gradient(90deg, rgba(0,255,120,0.08), rgba(0,180,80,0.04));
      backdrop-filter: blur(6px);
      border-bottom:1px solid rgba(255,255,255,0.05);
    }
    header h1{
      font-size:32px;letter-spacing:1px;color:#caffdd;
      text-shadow:0 0 18px rgba(100,255,160,0.12)
    }
    .cart-button{
      background:linear-gradient(90deg,#fff,#f4fff6);
      color:#007a4d;
      border:none; padding:10px 20px; border-radius:14px;
      font-weight:900; cursor:pointer; font-size:18px;
      box-shadow:0 12px 36px rgba(0,150,80,0.08);
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .cart-button:hover{ transform:translateY(-4px); box-shadow:0 22px 48px rgba(0,150,80,0.12) }

    /* ===== Layout ===== */
    .container{position:relative;z-index:2;display:flex;gap:28px;max-width:1400px;margin:20px auto;padding:0 28px 100px}
    .sidebar{
      width:240px;
      background:linear-gradient(180deg, rgba(0,40,20,0.7), rgba(0,20,10,0.65));
      padding:20px;border-radius:16px;
      border:1px solid rgba(0,255,150,0.12);
      box-shadow:0 28px 80px rgba(0,40,20,0.6);
      backdrop-filter: blur(6px);
    }
    .sidebar button{
      display:block;width:100%;margin-bottom:14px;padding:14px;border-radius:14px;border:none;
      background:linear-gradient(90deg,#00ff88,#00b46d);
      color:#012b16;font-weight:900;font-size:16px;cursor:pointer;
      box-shadow:0 12px 36px rgba(0,150,80,0.12);
      transition: transform .14s, box-shadow .14s;
    }
    .sidebar button:hover{ transform:translateY(-6px); box-shadow:0 18px 46px rgba(0,150,80,0.16) }

    /* ===== Products Grid ===== */
    .products{flex:1;display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:28px;align-content:start}
    .product{
      background:linear-gradient(180deg, rgba(4,40,20,0.9), rgba(2,20,10,0.88));
      border-radius:18px;padding:20px;
      border:1px solid rgba(0,255,150,0.10);
      box-shadow:0 28px 90px rgba(0,0,0,0.75);
      transition: transform .18s ease, box-shadow .18s ease, filter .18s;
      cursor: pointer;
    }
    .product:hover{ transform:translateY(-10px) scale(1.02); box-shadow:0 40px 120px rgba(0,255,160,0.18); filter:brightness(1.02) }
    .product img{width:100%;height:240px;object-fit:cover;border-radius:14px;margin-bottom:14px;background:linear-gradient(180deg,#222,#111)}
    .product h3{font-size:22px;margin-bottom:8px}
    .product p{font-size:18px;color:#d6ffec;margin-bottom:12px;font-weight:800}
    .product button{
      width:100%;padding:14px;border-radius:14px;border:none;
      background:linear-gradient(90deg,#00ff88,#00b46d);
      color:#012b16;font-weight:900;font-size:18px;cursor:pointer;
      transition:transform .12s;
    }
    .product button:hover{transform:translateY(-5px)}

    /* ===== Modal ===== */
    .modal{position:fixed;inset:0;z-index:12;display:none;align-items:center;justify-content:center;
      background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.9));padding:26px}
    .modal-content{
      width:400px;background:linear-gradient(180deg, rgba(0,40,20,0.96), rgba(0,20,10,0.98));
      border-radius:16px;padding:20px;
      border:1px solid rgba(0,255,150,0.12);
      box-shadow:0 36px 120px rgba(0,0,0,0.9);
    }
    .modal h2{color:#d6ffe7;margin-bottom:10px;text-align:center}
    .checkout-item{
      display:flex;justify-content:space-between;align-items:center;
      padding:12px;border-radius:12px;background:rgba(255,255,255,0.02);margin-bottom:10px
    }
    .remove-btn{background:none;color:#ff7d7d;border:none;font-size:18px;cursor:pointer}
    .checkout-footer{display:flex;justify-content:center;gap:12px;margin-top:18px}
    .buy-btn{
      padding:10px 20px;background:linear-gradient(90deg,#00ff88,#00b46d);
      color:#012b16;font-weight:900;border:none;border-radius:8px;cursor:pointer;
    }
    .buy-btn:hover{background:linear-gradient(90deg,#00e67a,#009f5f)}
    .cancel-btn{
      padding:10px 20px;background:#444;color:white;border:none;border-radius:8px;cursor:pointer;
    }
    .cancel-btn:hover{background:#666}

    /* Mutation modal specific */
    .mutations-list{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    .mutation-option{
      display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;
      background:rgba(255,255,255,0.02);cursor:pointer;
    }
    .mutation-option input{margin-right:12px}

    /* Cart badge */
    #cart-count{display:inline-block;padding:2px 8px;border-radius:999px;background:linear-gradient(90deg,#d6ffeb,#9effce);color:#01301c;font-weight:900;margin-left:6px}

    /* === Responsive Scaling (nur hinzugefügt) === */
    @media (max-width: 1200px) {
      .container { padding: 0 20px 80px; gap: 22px; }
      .products { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 22px; }
    }
    @media (max-width: 1024px) {
      .container { flex-direction: column; }
      .sidebar { width: 100%; display: flex; gap: 10px; flex-wrap: wrap; }
      .sidebar button { flex: 1 1 calc(50% - 10px); }
    }
    @media (max-width: 768px) {
      header h1 { font-size: 24px; }
      .cart-button { font-size: 16px; padding: 8px 14px; }
      .container { padding: 0 16px 70px; gap: 18px; }
      .products { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 18px; }
      .product img { height: 200px; }
    }
    @media (max-width: 480px) {
      header { flex-direction: column; gap: 10px; padding: 14px 16px; }
      .sidebar { gap: 8px; }
      .sidebar button { flex: 1 1 100%; font-size: 14px; padding: 10px; }
      .products { grid-template-columns: 1fr; gap: 14px; }
      .product { padding: 16px; }
      .product img { height: 180px; }
      .modal-content { width: 92%; padding: 16px; }
    }
  </style>
</head>
<body>
  <!-- Canvas & Nebula -->
  <canvas id="star-canvas"></canvas>
  <div class="nebula" aria-hidden="true"></div>
  <div class="gloss" aria-hidden="true"></div>

  <header>
    <h1>Garden Mart</h1>
    <button class="cart-button" onclick="openCart()">🛒 Cart (<span id="cart-count">0</span>)</button>
  </header>

  <div class="container">
    <div class="sidebar">
      <button onclick="showCategory('all')">All Products</button>
      <button onclick="showCategory('pets')">Pets</button>
      <button onclick="showCategory('sheckles')">Sheckles</button>
      <button onclick="showCategory('bundles')">Bundles</button>
    </div>

    <div class="products" id="products"></div>
  </div>

  <!-- Checkout Modal -->
  <div id="cart-modal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <h2>Checkout</h2>
      <div id="cart-items"></div>
      <p style="text-align:center;color:#ccc;">Payment Method: PayPal</p>
      <div class="checkout-footer">
        <button class="buy-btn" onclick="buyItems()">Buy</button>
        <button class="cancel-btn" onclick="closeCart()">Close</button>
      </div>
    </div>
  </div>

  <!-- Mutation Modal (for pets) -->
  <div id="mutation-modal" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="mutation-title">
      <h2 id="mutation-title">Choose a mutation</h2>
      <p id="mutation-product-name" style="text-align:center;color:#cfefe0;margin-bottom:8px;"></p>
      <div class="mutations-list" id="mutations-list">
        <!-- options injected here -->
      </div>
      <div class="checkout-footer" style="margin-top:14px">
        <button class="buy-btn" id="mutation-confirm">Add to Cart</button>
        <button class="cancel-btn" onclick="closeMutationModal()">Cancel</button>
      </div>
    </div>
  </div>

  <audio id="click-sound" src="click.mp3" preload="auto"></audio>

  <script>
    /* === Star background animation === */
    const canvas = document.getElementById('star-canvas');
    const ctx = canvas.getContext('2d');
    let W = canvas.width = innerWidth, H = canvas.height = innerHeight;
    window.addEventListener('resize', ()=>{ W = canvas.width = innerWidth; H = canvas.height = innerHeight; initStars(); });
    function rand(a,b){ return Math.random()*(b-a)+a; }
    let stars = [];
    const STAR_COUNT = Math.floor((window.innerWidth*window.innerHeight)/28000) + 90;
    function initStars(){
      stars = [];
      for(let i=0;i<STAR_COUNT;i++){
        stars.push({
          x: Math.random()*W,
          y: Math.random()*H,
          z: rand(0.2,1.2),
          r: rand(0.3,1.9),
          dx: rand(-0.04,0.04),
          dy: rand(-0.03,0.03),
          tw: Math.random()*1.8
        });
      }
    }
    initStars();
    let t=0;
    function drawStars(){
      ctx.clearRect(0,0,W,H);
      const g = ctx.createLinearGradient(0,0,W,H);
      g.addColorStop(0,'rgba(120,255,200,0.01)');
      g.addColorStop(1,'rgba(0,200,120,0.01)');
      ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
      for(const s of stars){
        const tw = Math.sin(t*0.02*s.tw)*0.7 + 0.8;
        const size = s.r * tw * s.z;
        ctx.beginPath();
        ctx.fillStyle = `rgba(255,255,255,${0.55 * s.z * tw})`;
        ctx.arc(s.x,s.y,Math.max(0.2,size),0,Math.PI*2); ctx.fill();
        s.x += s.dx*(1+0.6*s.z);
        s.y += s.dy*(1+0.6*s.z);
        if(s.x < -10) s.x = W+10; if(s.x > W+10) s.x = -10;
        if(s.y < -10) s.y = H+10; if(s.y > H+10) s.y = -10;
      }
      t++; requestAnimationFrame(drawStars);
    }
    drawStars();

    /* === Your original script (modified minimally to add mutations for pets) === */
    let productsData = [];
    let cart = [];

    // Mutation definitions (you can adjust names & price deltas here)
    const MUTATIONS = [
      { id: 'none', name: 'None', delta: 0 },
      { id: 'albino', name: 'Albino (+$5.00)', delta: 5.00 },
      { id: 'giant', name: 'Giant (+$10.00)', delta: 10.00 },
      { id: 'winged', name: 'Winged (+$15.00)', delta: 15.00 }
    ];

    function playClick() {
      const audio = document.getElementById("click-sound");
      if (audio && audio.play) {
        audio.currentTime = 0;
        audio.play().catch(() => {});
      }
    }

    // Format price helper
    function fmtPrice(v) {
      const n = (typeof v === 'number') ? v : parseFloat(v);
      if (isNaN(n)) return v;
      return n.toFixed(2);
    }

    // Modified showProducts: uses handleAddClick and opens mutation modal on product click for pets.
    function showProducts(filter) {
      const container = document.getElementById("products");
      container.innerHTML = "";
      const filtered = (filter === "all" || !filter) ? productsData : productsData.filter(p => p.category === filter);
      filtered.forEach(product => {
        const el = document.createElement("div");
        el.classList.add("product");
        const price = (typeof product.price === "number") ? product.price.toFixed(2) : product.price;
        el.innerHTML = `
          <img src="${product.image}" alt="${product.name}">
          <h3>${product.name}</h3>
          <p>$${price}</p>
          <button onclick="handleAddClick(${product.id}); playClick(); event.stopPropagation()">Add to Cart</button>
        `;

        // clicking the product container (not the button) will also open mutation menu for pets or add directly for others
        el.addEventListener('click', (e) => {
          if (e.target.tagName.toLowerCase() === 'button') return; // already handled by button
          handleAddClick(product.id);
          playClick();
        });

        container.appendChild(el);
      });
    }

    // Main entry when user wants to add a product to cart
    function handleAddClick(id) {
      const product = productsData.find(p => p.id === id);
      if (!product) return;
      // Only show mutation modal for category 'pets'
      if (product.category && product.category.toString().toLowerCase() === 'pets') {
        openMutationModal(product);
      } else {
        // behave exactly as before: direct add (no mutation)
        addToCartSimple(product);
      }
    }

    // original addToCart behavior preserved as a helper
    function addToCartSimple(product) {
      cart.push(product);
      document.getElementById("cart-count").textContent = cart.length;
    }

    // New: add to cart with mutation object (mutation.id, mutation.name, mutation.delta)
    function addToCartWithMutation(product, mutation) {
      // create a shallow copy to avoid mutating original product
      const basePrice = (typeof product.price === 'number') ? product.price : parseFloat(product.price);
      const delta = mutation && typeof mutation.delta === 'number' ? mutation.delta : 0;
      const finalPrice = (isNaN(basePrice) ? product.price : (basePrice + delta));

      const cartItem = {
        id: product.id,
        name: product.name,
        image: product.image,
        basePrice: basePrice,
        mutation: mutation ? { id: mutation.id, name: mutation.name, delta: mutation.delta } : { id: 'none', name: 'None', delta: 0 },
        price: finalPrice
      };

      cart.push(cartItem);
      document.getElementById("cart-count").textContent = cart.length;
    }

    // Cart modal / listing
    function openCart() {
      playClick();
      const cartItems = document.getElementById("cart-items");
      cartItems.innerHTML = "";
      if (cart.length === 0) {
        cartItems.innerHTML = '<p style="text-align:center;color:#ccc;">Your cart is empty.</p>';
      } else {
        cart.forEach((item, index) => {
          const div = document.createElement("div");
          div.classList.add("checkout-item");

          // If item has mutation object (we added mutated items as objects), show mutation info
          if (item.mutation) {
            div.innerHTML = `
              <div style="display:flex;flex-direction:column;gap:6px;">
                <strong>${item.name}</strong>
                <small style="color:#cfefe0">${item.mutation.name === 'None' ? '' : item.mutation.name}</small>
              </div>
              <div style="text-align:right;">
                <div>$${fmtPrice(item.price)}</div>
                <button class="remove-btn" onclick="removeItem(${index})">❌</button>
              </div>
            `;
          } else {
            // legacy items (added before mutation support) kept working
            const price = (typeof item.price === "number") ? item.price.toFixed(2) : item.price;
            div.innerHTML = `
              <span>${item.name} - $${price}</span>
              <button class="remove-btn" onclick="removeItem(${index})">❌</button>
            `;
          }
          cartItems.appendChild(div);
        });
      }
      document.getElementById("cart-modal").style.display = "flex";
    }

    function closeCart() {
      playClick();
      document.getElementById("cart-modal").style.display = "none";
    }

    function removeItem(index) {
      playClick();
      cart.splice(index, 1);
      document.getElementById("cart-count").textContent = cart.length;
      openCart();
    }

    function buyItems() {
      playClick();
      if (cart.length > 0) {
        window.location.href = "https://paypal.me/Mananquil19";
      }
    }

    /* === Mutation modal logic === */
    let _mutationTargetProduct = null; // product being mutated

    function openMutationModal(product) {
      _mutationTargetProduct = product;
      const modal = document.getElementById("mutation-modal");
      const nameEl = document.getElementById("mutation-product-name");
      nameEl.textContent = `${product.name} — $${fmtPrice(product.price)}`;

      // render mutation options
      const list = document.getElementById("mutations-list");
      list.innerHTML = "";
      MUTATIONS.forEach((m, idx) => {
        const opt = document.createElement("label");
        opt.className = 'mutation-option';
        opt.innerHTML = `
          <div style="display:flex;align-items:center;">
            <input type="radio" name="mutation" value="${m.id}" id="mut-${m.id}" ${idx===0 ? 'checked' : ''}>
            <span>${m.name}</span>
          </div>
          <div style="min-width:70px;text-align:right;">${m.delta === 0 ? '' : ('+$' + fmtPrice(m.delta))}</div>
        `;
        list.appendChild(opt);

        // clicking the div selects the radio
        opt.addEventListener('click', () => {
          document.getElementById(`mut-${m.id}`).checked = true;
        });
      });

      // attach confirm handler
      const confirmBtn = document.getElementById("mutation-confirm");
      confirmBtn.onclick = () => {
        const selectedId = (document.querySelector('input[name="mutation"]:checked') || {}).value || 'none';
        const selected = MUTATIONS.find(x => x.id === selectedId) || MUTATIONS[0];
        // Add to cart with mutation
        addToCartWithMutation(product, selected);
        closeMutationModal();
        playClick();
      };

      modal.style.display = 'flex';
    }

    function closeMutationModal() {
      const modal = document.getElementById("mutation-modal");
      modal.style.display = 'none';
      _mutationTargetProduct = null;
    }

    // close mutation modal by clicking outside content
    document.getElementById('mutation-modal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('mutation-modal')) closeMutationModal();
    });

    // Also close cart modal by clicking outside
    document.getElementById('cart-modal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('cart-modal')) closeCart();
    });

    /* === load products.json as before === */
    fetch('products.json')
      .then(response => {
        if (!response.ok) throw new Error('Could not load products.json');
        return response.json();
      })
      .then(data => {
        productsData = Array.isArray(data) ? data : (data.products || []);
        showProducts('all');
      })
      .catch(err => {
        console.error(err);
        const container = document.getElementById("products");
        container.innerHTML = '<p style="color:#f55; padding:30px;">Products could not be loaded. Check products.json.</p>';
      });
  </script>
</body>
</html>
